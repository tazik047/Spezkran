(function(e){var t=function(t){var n=this;this.panel=t;this.selectedItem=null;this.init=function(){e("#md-toolbar a").click(function(){if(e(this).hasClass("mdt-text")){n.panel.addBoxItem("text")}else if(e(this).hasClass("mdt-image")){n.panel.addBoxItem("image")}else if(e(this).hasClass("mdt-video")){n.panel.addBoxItem("video")}else if(e(this).hasClass("mdt-align-left")){n.panel.alignLeftSelectedBox()}else if(e(this).hasClass("mdt-align-right")){n.panel.alignRightSelectedBox()}else if(e(this).hasClass("mdt-align-center")){n.panel.alignCenterSelectedBox()}else if(e(this).hasClass("mdt-align-top")){n.panel.alignTopSelectedBox()}else if(e(this).hasClass("mdt-align-bottom")){n.panel.alignBottomSelectedBox()}else if(e(this).hasClass("mdt-align-vcenter")){n.panel.alignMiddleSelectedBox(e("input.mdt-spacei","#md-toolbar").val())}else if(e(this).hasClass("mdt-spacev")){n.panel.spaceVertical(e("input.mdt-spacei","#md-toolbar").val())}else if(e(this).hasClass("mdt-spaceh")){n.panel.spaceHorizontal(e("input.mdt-spacei","#md-toolbar").val())}return false});e("input.mdt-width","#md-toolbar").keyup(function(){if(e("a.mdt-proportions","#md-toolbar").hasClass("mdt-proportions-yes")){var t=e("a.mdt-proportions","#md-toolbar").data("proportions");if(t>0){e("input.mdt-height","#md-toolbar").val(Math.round(e(this).val()/t))}}});e("input.mdt-height","#md-toolbar").keyup(function(){if(e("a.mdt-proportions","#md-toolbar").hasClass("mdt-proportions-yes")){var t=e("a.mdt-proportions","#md-toolbar").data("proportions");if(t>0){e("input.mdt-width","#md-toolbar").val(Math.round(e(this).val()*t))}}});e("input, select","#md-toolbar").keypress(function(t){var n=t.keyCode||t.which;if(n==13){e(this).trigger("change");t.preventDefault()}});e("input.mdt-input, select.mdt-input","#md-toolbar").change(function(){var t=e(this).attr("name");switch(t){case"background-transparent":case"background-color":n.panel.setItemBackground(t,e(this).val());return true;break;case"left":case"top":n.panel.setItemAttribute(t,e(this).val());break;case"width":case"height":n.panel.setItemSize(e("input.mdt-width","#md-toolbar").val(),e("input.mdt-height","#md-toolbar").val());break;case"font-size":n.panel.setItemFontSize(t,e(this).val());break;case"style":n.panel.setItemStyle(t,e(this).val());break;case"opacity":n.panel.setItemOpacity(t,e(this).val());break;case"color":n.panel.setItemColor(e(this).val());break;case"border-color":n.panel.setItemBorderColor(t,e(this).val());break;case"border-width":n.panel.setItemCssPx(t,e(this).val());break;case"border-style":n.panel.changeBorderStyle(e(this).val());break;default:n.panel.setItemCss(t,e(this).val())}return false});e("a.button-style","#md-toolbar").click(function(){if(e(this).hasClass("active")){n.panel.setItemCss(e(this).attr("name"),e(this).attr("normal"));e(this).removeClass("active")}else{n.panel.setItemCss(e(this).attr("name"),e(this).attr("active"));e(this).addClass("active")}return false});e("a.button-align","#md-toolbar").click(function(){if(e(this).hasClass("active")){if(e(this).hasClass("mdt-left-alignment"))return;n.panel.setItemCss("text-align","left");e("a.mdt-left-alignment","#md-toolbar").addClass("active");e(this).removeClass("active")}else{n.panel.setItemCss("text-align",e(this).attr("value"));e("a.button-align","#md-toolbar").removeClass("active");e(this).addClass("active")}return false});e("textarea","#md-toolbar").keyup(function(){n.panel.setItemTitle(e(this).val())});e("a.mdt-proportions","#md-toolbar").click(function(){if(!e("#md-toolbar").attr("disabled")||e("#md-toolbar").attr("disabled")=="false"){if(e(this).hasClass("mdt-proportions-yes")){e(this).removeClass("mdt-proportions-yes")}else{var t=e("input.mdt-width","#md-toolbar").val();var n=e("input.mdt-height","#md-toolbar").val();var r=1;if(t>0&&n>0)r=t/n;e(this).data("proportions",r);e(this).addClass("mdt-proportions-yes")}}});e("#dlg-video").dialog({resizable:false,autoOpen:false,draggable:false,modal:true,width:680,buttons:{OK:function(){n.updateVideo(e("#videoid").val(),e("#videoname").val(),e("#videothumb").attr("src"));e(this).dialog("close")}},open:function(){var t=n.getVideoValue();e("#videoid").val(t.id);e("#videoname").val(t.name);e("#videothumb").attr("src",t.thumbsrc)},close:function(){e(this).empty()}});e("a.mdt-background-color").ColorPicker({onBeforeShow:function(){current_obj=this;e(this).ColorPickerSetColor(e("#background-color").val())},onChange:function(t,n,r){if(t==""){e("#background-color").val("").trigger("change");e(current_obj).css("backgroundColor","")}else{e("#background-color").val(n).trigger("change");e(current_obj).css("backgroundColor","#"+n)}},onSubmit:function(t,n,r,i){e(i).ColorPickerHide()}});e("a.mdt-text-color").ColorPicker({onBeforeShow:function(){current_obj=this;e(this).ColorPickerSetColor(e("input.mdt-color").val())},onChange:function(t,n,r){if(t==""){e("input.mdt-color","#md-toolbar").val("").trigger("change");e(current_obj).css("backgroundColor","")}else{e("input.mdt-color","#md-toolbar").val(n).trigger("change");e(current_obj).css("backgroundColor","#"+n)}},onSubmit:function(t,n,r,i){e(i).ColorPickerHide()}});e(".panel-change-videothumb").live("click",function(){Drupal.media.popups.mediaBrowser(function(t){var n=t[0];e("#videothumb").attr("src",n.url)})});e("#btn-search").live("click",function(){var t=e("#txtvideoid").val();var n=Drupal.settings.basePath+"?q=admin/structure/md-slider/get-video-info";n=location.protocol+"//"+location.host+n;e.getJSON(n,{url:t},function(t){switch(t.type){case"youtube":if(t.data){var n=t.data.data;e("#videoid").val(n.id);e("#videoname").val(n.title);e("#videothumb").attr("src",n.thumbnail.sqDefault)}break;case"vimeo":if(t.data){var n=t.data;e("#videoid").val(n.id);e("#videoname").val(n.title);e("#videothumb").attr("src",n.thumbnail_small)}break;default:alert("Could not find video info for this link. Try again!");break}if(e("#videothumb").size()<=0){e("#videothumb").parent().append('<a class="panel-change-videothumb" href="#">[Change video thumb]</a>')}})});e("#change-video").click(function(){var t=n.getVideoValue();var r=t.id!=""?1:0;var i=Drupal.settings.basePath+"?q=admin/structure/md-slider/video-setting";i=location.protocol+"//"+location.host+i;e.post(i,{change:r},function(t){e("#dlg-video").append(t).dialog("open")});return false});e("#change-image").click(function(){Drupal.media.popups.mediaBrowser(function(t){var r=t[0];e("textarea.mdt-imgalt","#md-toolbar").val(r.filename);e("img.mdt-imgsrc","#md-toolbar").attr("src",r.url);e("input.mdt-fileid","#md-toolbar").val(r.fid);n.panel.setImageData(r.fid,r.filename,r.url)})});e("#md-toolbar select.mdt-font-family").change(function(){n.panel.changeFontFamily(e(this).val());n.changeFontWeightOption(e("option:selected",this).data("fontweight"))});e("#md-toolbar select.mdt-font-weight").change(function(){var t=e(this).val();e(this).data("value",t);n.panel.setItemFontWeight(t)});e("#border-position a").click(function(){if(e(this).hasClass("bp-all")){var t=e(this).siblings();if(t.filter(".active").size()<4){t.addClass("active")}else{t.removeClass("active")}}else{e(this).toggleClass("active")}n.changeBorderPosition()});e("#md-toolbar a.mdt-border-color").ColorPicker({onBeforeShow:function(){current_obj=this;e(this).ColorPickerSetColor(e("#border-color").val())},onChange:function(t,n,r){if(t==""){e("#border-color").val("").trigger("change");e(current_obj).css("backgroundColor","")}else{e("#border-color").val(n).trigger("change");e(current_obj).css("backgroundColor","#"+n)}},onSubmit:function(t,n,r,i){e(i).ColorPickerHide()}});e("#md-toolbar input.mdt-border-radius").change(function(){if(e(this).val()!=""&&!isNaN(e(this).val())){if(e(this).siblings("input.mdt-border-radius").filter("[value=]").size()==3){var t=parseInt(e(this).val());e(this).siblings("input.mdt-border-radius").each(function(){e(this).val(t);n.panel.setItemCssPx(e(this).attr("name"),t)})}}else{e(this).val(0)}n.panel.setItemCssPx(e(this).attr("name"),e(this).val())});e("#md-toolbar input.mdt-padding").change(function(){if(e(this).val()!=""&&!isNaN(e(this).val())){if(e(this).siblings("input.mdt-padding").filter("[value=]").size()==3){var t=parseInt(e(this).val());e(this).siblings("input.mdt-padding").each(function(){e(this).val(t);n.panel.setItemCssPx(e(this).attr("name"),t)})}}else{e(this).val(0)}n.panel.setItemCssPx(e(this).attr("name"),e(this).val())});e("#md-toolbar a.mdt-addlink").click(function(){var t=n.selectedItem.getItemValues();var i=e.extend({value:"",title:"",color:"",background:"",transparent:"",border:""},t.link);e("#mdt-linkexpand input.mdt-link-value").val(i.value);e("#mdt-linkexpand input.mdt-link-title").val(i.title);e("#mdt-linkexpand input.link-color").val(i.color);i.color!=""?e("#mdt-linkexpand a.mdt-link-color").css("backgroundColor","#"+i.color):e("#mdt-linkexpand a.mdt-link-color").css("backgroundColor","");e("#mdt-linkexpand input.link-background").val(i.background);i.background!=""?e("#mdt-linkexpand a.mdt-link-background").css("backgroundColor","#"+i.background):e("#mdt-linkexpand a.mdt-link-background").css("backgroundColor","");e("#mdt-linkexpand input.link-background-transparent").val(i.transparent);e("#mdt-linkexpand input.link-border").val(i.border);i.border!=""?e("#mdt-linkexpand a.mdt-link-border").css("backgroundColor","#"+i.border):e("#mdt-linkexpand a.mdt-link-border").css("backgroundColor","");e("#mdt-linkexpand").data("item",n.selectedItem).show();e(document).bind("click",r)});e("#mdt-linkexpand a.mdt-link-close").click(function(){e("#mdt-linkexpand").data("item",null);e("#mdt-linkexpand").hide()});e("#mdt-linkexpand a.mdt-edit-color").ColorPicker({onBeforeShow:function(){current_obj=this;e(this).ColorPickerSetColor(e(this).next().val());e(document).unbind("click",r)},onChange:function(t,n,r){if(t==""){e(current_obj).next().val("");e(current_obj).css("backgroundColor","")}else{e(current_obj).next().val(n);e(current_obj).css("backgroundColor","#"+n)}},onSubmit:function(t,n,r,i){e(i).ColorPickerHide()},onHide:function(){e(document).bind("click",r)}});e("#mdt-linkexpand a.mdt-link-save").click(function(){n.saveLinkData();e("#mdt-linkexpand").hide();e(document).unbind("click",r)});e("#mdt-linkexpand a.mdt-link-remove").click(function(){var t=e("#mdt-linkexpand").data("item");if(t!=null){e(t).data("link",null)}e("#mdt-linkexpand").data("item",null);e("#mdt-linkexpand").hide()});n.disableToolbar()};this.saveLinkData=function(){var t={value:e("#mdt-linkexpand input.mdt-link-value").val(),title:e("#mdt-linkexpand input.mdt-link-title").val(),color:e("#mdt-linkexpand input.link-color").val(),background:e("#mdt-linkexpand input.link-background").val(),transparent:e("#mdt-linkexpand input.link-background-transparent").val(),border:e("#mdt-linkexpand input.link-border").val()};var n=e("#mdt-linkexpand").data("item");if(t.value!=""&&n!=null){e(n).data("link",t)}};this.changeBorderPosition=function(){var t=e("#border-position a.bp-top").hasClass("active")?1:0,r=e("#border-position a.bp-right").hasClass("active")?2:0,i=e("#border-position a.bp-bottom").hasClass("active")?4:0,s=e("#border-position a.bp-left").hasClass("active")?8:0;n.panel.changeBorderPosition(t+r+i+s)};this.weightArray={100:"Thin","100italic":"Thin Italic",200:"Extra Light","200italic":"Extra Light Italic",300:"Light","300italic":"Light Italic",400:"Normal","400italic":"Italic",500:"Medium","500italic":"Medium Italic",600:"Semi Bold","600italic":"Semi Bold Italic",700:"Bold","700italic":"Bold Italic",800:"Extra Bold","800italic":"Extra Bold Italic",900:"Heavy","900italic":"Heavy Italic"};this.changeFontWeightOption=function(t){var r='<option value=""></option>';var i=e("#md-toolbar select.mdt-font-weight").data("value");if(t){var s=t.split(",");var o=n.weightArray;for(var u=0;u<s.length;u++){var a=s[u];r+='<option value="'+a+'">'+o[a]+"</option>"}}e("#md-toolbar select.mdt-font-weight").html(r).val(i)};this.changeSelectItem=function(e){this.selectedItem=e;this.triggerChangeSelectItem()};this.triggerChangeSelectItem=function(){n.saveLinkData();e("#mdt-linkexpand").hide();if(this.selectedItem==null){this.disableToolbar()}else{this.changeToolbarValue();if(e("#md-toolbar").attr("disabled")){this.enableToolbar()}}};this.disableToolbar=function(){e("input, select, textarea","#md-toolbar").not("input.mdt-spacei").val("").attr("disabled",true);e("#md-toolbar div.mdt-item-type").hide();e("#md-toolbar").attr("disabled",true)};this.enableToolbar=function(){e("input, select, textarea","#md-toolbar").removeAttr("disabled");e("#md-toolbar").attr("disabled",false)};this.changeToolbarValue=function(){if(this.selectedItem!=null){var t=this.selectedItem.getItemValues();e("input.mdt-width","#md-toolbar").val(t.width);e("input.mdt-height","#md-toolbar").val(t.height);e("input.mdt-left","#md-toolbar").val(t.left);e("input.mdt-top","#md-toolbar").val(t.top);e("input.mdt-starttime","#md-toolbar").val(t.starttime);e("input.mdt-stoptime","#md-toolbar").val(t.stoptime);e("select.mdt-startani","#md-toolbar").val(t.startani);e("select.mdt-stopani","#md-toolbar").val(t.stopani);e("input.mdt-opacity","#md-toolbar").val(t.opacity);e("select.mdt-style","#md-toolbar").val(t.style);e("input.mdt-background","#md-toolbar").val(t.backgroundcolor);t.backgroundcolor!=null?e("a.mdt-background-color","#md-toolbar").css("backgroundColor","#"+t.backgroundcolor):e("a.mdt-background-color","#md-toolbar").css("backgroundColor","");e("input.mdt-background-transparent","#md-toolbar").val(t.backgroundtransparent);e("#border-position a").removeClass("active");var n=t.borderposition;if(n&1){e("#border-position a.bp-top").addClass("active")}if(n&2){e("#border-position a.bp-right").addClass("active")}if(n&4){e("#border-position a.bp-bottom").addClass("active")}if(n&8){e("#border-position a.bp-left").addClass("active")}e("input.mdt-border-width","#md-toolbar").val(t.borderwidth);e("select.mdt-border-style","#md-toolbar").val(t.borderstyle);t.bordercolor?e("a.mdt-border-color","#md-toolbar").css("backgroundColor","#"+t.bordercolor):e("a.mdt-border-color","#md-toolbar").css("backgroundColor","");e("input.border-color","#md-toolbar").val(t.bordercolor);e("input.mdt-br-topleft","#md-toolbar").val(t.bordertopleftradius);e("input.mdt-br-topright","#md-toolbar").val(t.bordertoprightradius);e("input.mdt-br-bottomright","#md-toolbar").val(t.borderbottomrightradius);e("input.mdt-br-bottomleft","#md-toolbar").val(t.borderbottomleftradius);e("input.mdt-p-top","#md-toolbar").val(t.paddingtop);e("input.mdt-p-right","#md-toolbar").val(t.paddingright);e("input.mdt-p-bottom","#md-toolbar").val(t.paddingbottom);e("input.mdt-p-left","#md-toolbar").val(t.paddingleft);var r=1;if(t.width>0&&t.height>0)r=t.width/t.height;e("a.mdt-proportions","#md-toolbar").data("proportions",r);var i=e("#md-toolbar div.mdt-item-type").hide();if(t.type=="text"){e("textarea.mdt-textvalue","#md-toolbar").val(t.title);e(i).filter(".mdt-type-text").show();e("input.mdt-fontsize","#md-toolbar").val(t.fontsize);e("select.mdt-font-family","#md-toolbar").val(t.fontfamily).trigger("change");e("select.mdt-font-weight","#md-toolbar").val(t.fontweight);e("a.mdt-font-bold","#md-toolbar").toggleClass("active",t.fontweight=="bold");e("a.mdt-font-italic","#md-toolbar").toggleClass("active",t.fontstyle=="italic");e("a.mdt-font-underline","#md-toolbar").toggleClass("active",t.textdecoration=="underline");e("a.mdt-font-allcaps","#md-toolbar").toggleClass("active",t.texttransform=="uppercase");e("a.mdt-left-alignment","#md-toolbar").toggleClass("active",t.textalign=="left");e("a.mdt-center-alignment","#md-toolbar").toggleClass("active",t.textalign=="center");e("a.mdt-right-alignment","#md-toolbar").toggleClass("active",t.textalign=="right");e("a.mdt-justified-alignment","#md-toolbar").toggleClass("active",t.textalign=="justified");e("input.mdt-color","#md-toolbar").val(t.color);t.color?e("a.mdt-text-color","#md-toolbar").css("backgroundColor","#"+t.color):e("a.mdt-text-color","#md-toolbar").css("backgroundColor","")}else if(t.type=="image"){e("textarea.mdt-imgalt","#md-toolbar").val(t.title);e("img.mdt-imgsrc","#md-toolbar").attr("src",t.thumb);e("input.mdt-fileid","#md-toolbar").val(t.fileid);e(i).filter(".mdt-type-image").show()}else if(t.type=="video"){e("textarea.mdt-videoname","#md-toolbar").val(t.title);e("input.mdt-video-fileid","#md-toolbar").val(t.fileid);e("img.mdt-videosrc","#md-toolbar").attr("src",t.thumb);e(i).filter(".mdt-type-video").show();e("#md-toolbar input.mdt-color").attr("disabled",true)}}};this.changePositionValue=function(t,n){e("input.mdt-left","#md-toolbar").val(Math.round(t));e("input.mdt-top","#md-toolbar").val(Math.round(n))};this.changeSizeValue=function(t,n){e("input.mdt-width","#md-toolbar").val(Math.round(t));e("input.mdt-height","#md-toolbar").val(Math.round(n))};this.getItemSetting=function(){return{starttime:e("input.mdt-starttime","#md-toolbar").val(),stoptime:e("input.mdt-stoptime","#md-toolbar").val(),startani:e("select.mdt-startani","#md-toolbar").val(),stopani:e("select.mdt-stopani","#md-toolbar").val(),opacity:e("input.mdt-opacity","#md-toolbar").val(),style:e("select.mdt-style","#md-toolbar").val()}};this.changeTimelineValue=function(){if(this.selectedItem!=null){e("input.mdt-starttime","#md-toolbar").val(Math.round(this.selectedItem.data("starttime")));e("input.mdt-stoptime","#md-toolbar").val(Math.round(this.selectedItem.data("stoptime")))}};this.updateVideo=function(t,r,i){e("textarea.mdt-videoname","#md-toolbar").val(r);e("input.mdt-video-fileid","#md-toolbar").val(t);e("img.mdt-videosrc","#md-toolbar").attr("src",i);n.panel.setVideoData(t,r,i)};this.getVideoValue=function(){return{name:e("textarea.mdt-videoname","#md-toolbar").val(),thumbsrc:e("img.mdt-videosrc","#md-toolbar").attr("src"),id:e("input.mdt-video-fileid","#md-toolbar").val()}};this.focusEdit=function(){if(this.selectedItem!=null){var t=this.selectedItem.data("type");if(t=="text"){e("textarea.mdt-textvalue","#md-toolbar").focus()}else if(t=="image"){e("#change-image").trigger("click")}else if(t=="video"){e("#change-video").trigger("click")}}};var r=function(t){if(!i(e("#mdt-linkexpand").get(0),t.target,e("#mdt-linkexpand").get(0))){n.saveLinkData();e("#mdt-linkexpand").data("item",null);e("#mdt-linkexpand").hide();e(document).unbind("click",r)}},i=function(e,t,n){if(e==t){return true}if(e.contains){return e.contains(t)}if(e.compareDocumentPosition){return!!(e.compareDocumentPosition(t)&16)}var r=t.parentNode;while(r&&r!=n){if(r==e)return true;r=r.parentNode}return false};this.init()};window.MdSliderToolbar=t})(jQuery)